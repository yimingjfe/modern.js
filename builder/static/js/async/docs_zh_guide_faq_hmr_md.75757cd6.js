(self.webpackChunk_modern_js_builder_doc=self.webpackChunk_modern_js_builder_doc||[]).push([["docs_zh_guide_faq_hmr_md"],{56343:function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});!function(e,n){for(var r in n)Object.defineProperty(e,r,{enumerable:!0,get:n[r]})}(n,{frontmatter:function(){return c},title:function(){return a},toc:function(){return h},default:function(){return l}});var t=r("9880"),s=r("23169"),c={},a="热更新问题",h=[{text:"打包时 external React 后，热更新不生效？",depth:3,id:"打包时-external-react-后，热更新不生效？"},{text:"开发环境设置文件名的 hash 后，热更新不生效？",depth:3,id:"开发环境设置文件名的-hash-后，热更新不生效？"},{text:"React 组件的热更新无法生效？",depth:3,id:"react-组件的热更新无法生效？"},{text:"开启 https 后，热更新不生效？",depth:3,id:"开启-https-后，热更新不生效？"}];function d(e){var n=Object.assign({h1:"h1",a:"a",h3:"h3",p:"p",pre:"pre",code:"code",hr:"hr",ul:"ul",li:"li",img:"img",blockquote:"blockquote"},(0,s.useMDXComponents)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.h1,{id:"热更新问题",children:["热更新问题",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#热更新问题",children:"#"})]}),"\n",(0,t.jsxs)(n.h3,{id:"打包时-external-react-后，热更新不生效？",children:["打包时 external React 后，热更新不生效？",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#打包时-external-react-后，热更新不生效？",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"为了保证热更新生效，我们需要使用 React 和 ReactDOM 的开发环境产物。"}),"\n",(0,t.jsx)(n.p,{children:"当你将 React 通过 externals 排除后，通常会通过 CDN 等方式注入 React 的生产环境产物，所以热更新会不生效。"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"export default {\n  output: {\n    externals: {\n      react: 'React',\n      'react-dom': 'ReactDOM',\n    },\n  },\n};\n"})}),"\n",(0,t.jsxs)(n.p,{children:["为了解决该问题，你需要引用 React 的开发环境产物，或者在开发环境下不配置 ",(0,t.jsx)(n.code,{children:"externals"}),"。"]}),"\n",(0,t.jsxs)(n.p,{children:["如果你不确定当前使用的 React 产物类型，可以参考：",(0,t.jsx)(n.a,{href:"https://legacy.reactjs.org/docs/optimizing-performance.html#use-the-production-build",target:"_blank",rel:"noopener noreferrer",children:"React 官方文档 - Use the Production Build"})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.h3,{id:"开发环境设置文件名的-hash-后，热更新不生效？",children:["开发环境设置文件名的 hash 后，热更新不生效？",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#开发环境设置文件名的-hash-后，热更新不生效？",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["通常来说，我们只会在生产环境下设置文件名的 hash 值（即 ",(0,t.jsx)(n.code,{children:"process.env.NODE_ENV === 'production'"})," 时）。"]}),"\n",(0,t.jsxs)(n.p,{children:["如果你在开发环境下设置了文件名的 hash，那么可能会导致热更新不生效（尤其是 CSS 文件）。这是因为每次文件内容变化时，都会引起 hash 变化，导致 ",(0,t.jsx)(n.a,{href:"https://www.npmjs.com/package/mini-css-extract-plugin",target:"_blank",rel:"noopener noreferrer",children:"mini-css-extract-plugin"})," 等工具无法读取到最新的文件内容。"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"正确用法："}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"export default {\n  output: {\n    filename: {\n      css:\n        process.env.NODE_ENV === 'production'\n          ? '[name].[contenthash:8].css'\n          : '[name].css',\n    },\n  },\n};\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"错误用法："}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"export default {\n  output: {\n    filename: {\n      css: '[name].[contenthash:8].css',\n    },\n  },\n};\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.h3,{id:"react-组件的热更新无法生效？",children:["React 组件的热更新无法生效？",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#react-组件的热更新无法生效？",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Builder 使用 React 官方的 ",(0,t.jsx)(n.a,{href:"https://github.com/pmmmwh/react-refresh-webpack-plugin",target:"_blank",rel:"noopener noreferrer",children:"Fast Refresh"})," 能力来进行组件热更新。"]}),"\n",(0,t.jsx)(n.p,{children:"如果出现 React 组件的热更新无法生效的问题，或者是热更新后 React 组件的 state 丢失，这通常是因为你的 React 组件使用了匿名函数。在 React Fast Refresh 的官方实践中，要求组件不能为匿名函数，否则热更新后无法保留 React 组件的 state。"}),"\n",(0,t.jsx)(n.p,{children:"以下是一些错误用法的例子："}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"// 错误写法 1\nexport default function () {\n  return <div>Hello World</div>;\n}\n\n// 错误写法 2\nexport default () => <div>Hello World</div>;\n"})}),"\n",(0,t.jsx)(n.p,{children:"正确用法是给每个组件函数声明一个名称："}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"// 正确写法 1\nexport default function MyComponent() {\n  return <div>Hello World</div>;\n}\n\n// 正确写法 2\nconst MyComponent = () => <div>Hello World</div>;\n\nexport default MyComponent;\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.h3,{id:"开启-https-后，热更新不生效？",children:["开启 https 后，热更新不生效？",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#开启-https-后，热更新不生效？",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"当开启 https 时，由于证书的问题，可能会出现 HMR 连接失败的情况，此时打开控制台，会出现 HMR connect failed 的报错。"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://lf3-static.bytednsdoc.com/obj/eden-cn/6221eh7uhbfvhn/modern/img_v2_2f90d027-a232-4bd8-8021-dac3c651682g.jpg",alt:"hmr-connect-error-0"})}),"\n",(0,t.jsx)(n.p,{children:"此问题的解决方法为：点击 Chrome 浏览器问题页面的「高级」->「继续前往 xxx（不安全）」。"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://lf3-static.bytednsdoc.com/obj/eden-cn/6221eh7uhbfvhn/modern/59b37606-52ad-4886-a423-af2edaa49245.png",alt:"hmr-connect-error-1"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Tips: 当通过 Localhost 访问页面时，「您的连接不是私密连接」字样可能不会出现，可访问 Network 域名进行处理。"}),"\n"]})]})}var l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(0,s.useMDXComponents)(),e.components).wrapper;return n?(0,t.jsx)(n,Object.assign({},e,{children:(0,t.jsx)(d,e)})):d(e)}}}]);