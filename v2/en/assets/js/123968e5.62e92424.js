"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3638],{44993:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>u});var a=n(52983);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(n),u=o,h=d["".concat(l,".").concat(u)]||d[u]||m[u]||r;return n?a.createElement(h,i(i({ref:t},p),{},{components:n})):a.createElement(h,i({ref:t},p))}));function u(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},66063:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(52983),o=n(14517);const r="tabItem_wcIk";function i(e){let{children:t,hidden:n,className:i}=e;return a.createElement("div",{role:"tabpanel",className:(0,o.Z)(r,i),hidden:n},t)}},99618:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(18249),o=n(52983),r=n(14517),i=n(20284),s=n(51074),l=n(27501),c=n(5689);const p="tabList_EzWc",m="tabItem_YZmL";function d(e){var t;const{lazy:n,block:i,defaultValue:d,values:u,groupId:h,className:f}=e,v=o.Children.map(e.children,(e=>{if((0,o.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),g=u??v.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),k=(0,s.l)(g,((e,t)=>e.value===t.value));if(k.length>0)throw new Error(`Docusaurus error: Duplicate values "${k.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const b=null===d?d:d??(null==(t=v.find((e=>e.props.default)))?void 0:t.props.value)??v[0].props.value;if(null!==b&&!g.some((e=>e.value===b)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${b}" but none of its children has the corresponding value. Available values are: ${g.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:y,setTabGroupChoices:x}=(0,l.U)(),[N,w]=(0,o.useState)(b),C=[],{blockElementScrollPositionUntilNextRender:I}=(0,c.o5)();if(null!=h){const e=y[h];null!=e&&e!==N&&g.some((t=>t.value===e))&&w(e)}const j=e=>{const t=e.currentTarget,n=C.indexOf(t),a=g[n].value;a!==N&&(I(t),w(a),null!=h&&x(h,String(a)))},T=e=>{var t;let n=null;switch(e.key){case"Enter":j(e);break;case"ArrowRight":{const t=C.indexOf(e.currentTarget)+1;n=C[t]??C[0];break}case"ArrowLeft":{const t=C.indexOf(e.currentTarget)-1;n=C[t]??C[C.length-1];break}}null==(t=n)||t.focus()};return o.createElement("div",{className:(0,r.Z)("tabs-container",p)},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":i},f)},g.map((e=>{let{value:t,label:n,attributes:i}=e;return o.createElement("li",(0,a.Z)({role:"tab",tabIndex:N===t?0:-1,"aria-selected":N===t,key:t,ref:e=>C.push(e),onKeyDown:T,onClick:j},i,{className:(0,r.Z)("tabs__item",m,null==i?void 0:i.className,{"tabs__item--active":N===t})}),n??t)}))),n?(0,o.cloneElement)(v.filter((e=>e.props.value===N))[0],{className:"margin-top--md"}):o.createElement("div",{className:"margin-top--md"},v.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==N})))))}function u(e){const t=(0,i.Z)();return o.createElement(d,(0,a.Z)({key:String(t)},e))}},66576:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>u,frontMatter:()=>s,metadata:()=>c,toc:()=>m});var a=n(18249),o=(n(52983),n(44993)),r=n(99618),i=n(66063);const s={title:"Add Container"},l=void 0,c={unversionedId:"tutorials/first-app/c07-container",id:"tutorials/first-app/c07-container",title:"Add Container",description:"In the previous chapter, we initially introduced the model to split this part of the logic from the UI component. The page.tsx no longer contains UI-independent business logic implementation details, and only needs to use the Model to implement the same function.",source:"@site/../../packages/toolkit/main-doc/en/docusaurus-plugin-content-docs/current/tutorials/first-app/c07-container.md",sourceDirName:"tutorials/first-app",slug:"/tutorials/first-app/c07-container",permalink:"/v2/en/docs/tutorials/first-app/c07-container",draft:!1,tags:[],version:"current",frontMatter:{title:"Add Container"},sidebar:"tutorialsSidebar",previous:{title:"Add Model",permalink:"/v2/en/docs/tutorials/first-app/c06-model"},next:{title:"Add Application Entry",permalink:"/v2/en/docs/tutorials/first-app/c08-entries"}},p={},m=[{value:"Use the full Model",id:"use-the-full-model",level:2},{value:"Withdraw container components",id:"withdraw-container-components",level:2}],d={toc:m};function u(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"In the previous chapter, we initially introduced the ",(0,o.kt)("strong",{parentName:"p"},"model")," to split this part of the logic from the UI component. The ",(0,o.kt)("inlineCode",{parentName:"p"},"page.tsx")," no longer contains UI-independent business logic implementation details, and only needs to use the Model to implement the same function."),(0,o.kt)("p",null,"In this chapter, we will further use the business logic of implementation in Model to let ",(0,o.kt)("inlineCode",{parentName:"p"},"page.tsx")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"archived/page.tsx")," get the same data. And implementation Archive button, click the button to display the point of contact archive only in the Archives list, not in the All list."),(0,o.kt)("h2",{id:"use-the-full-model"},"Use the full Model"),(0,o.kt)("p",null,"Because the two pages need to share the same set of state (point of contact tabular data, point of contact is archived or not), both need to contain the logic to load the initial data, so we need to complete the data acquisition at a higher level."),(0,o.kt)("p",null,"Modern.js support obtaining data through Data Loader in ",(0,o.kt)("inlineCode",{parentName:"p"},"layout.tsx"),", we first move the data acquisition part of the code to ",(0,o.kt)("inlineCode",{parentName:"p"},"src/routes/layout.tsx"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import { name, internet } from 'faker';\nimport {\n  Outlet,\n  useLoaderData,\n  useLocation,\n  useNavigate,\n} from '@modern-js/runtime/router';\nimport { useState } from 'react';\nimport { Radio, RadioChangeEvent } from 'antd';\nimport { useModel } from '@modern-js/runtime/model';\nimport contacts from '../models/contacts';\nimport 'tailwindcss/base.css';\nimport 'tailwindcss/components.css';\nimport 'tailwindcss/utilities.css';\nimport '../styles/utils.css';\n\ntype LoaderData = {\n  code: number;\n  data: {\n    name: string;\n    avatar: string;\n    email: string;\n  }[];\n};\n\nexport const loader = async (): Promise<LoaderData> => {\n  const data = new Array(20).fill(0).map(() => {\n    const firstName = name.firstName();\n    return {\n      name: firstName,\n      avatar: `https://avatars.dicebear.com/api/identicon/${firstName}.svg`,\n      email: internet.email(),\n    };\n  });\n\n  return {\n    code: 200,\n    data,\n  };\n};\n\nexport default function Layout() {\n  const { data } = useLoaderData() as LoaderData;\n  const [{ items }, { setItems }] = useModel(contacts);\n  if (items.length === 0) {\n    setItems(data);\n  }\n\n  const navigate = useNavigate();\n  ...\n}\n")),(0,o.kt)("p",null,"In ",(0,o.kt)("inlineCode",{parentName:"p"},"src/routes/page.tsx"),", use Model directly to get data:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import { Helmet } from '@modern-js/runtime/head';\nimport { useModel } from '@modern-js/runtime/model';\nimport { List } from 'antd';\nimport Item from '../components/Item';\nimport contacts from '../models/contacts';\n\nfunction Index() {\n  const [{ items }, { archive }] = useModel(contacts);\n\n  return (\n    <div className=\"container lg mx-auto\">\n      <Helmet>\n        <title>All</title>\n      </Helmet>\n      <List\n        dataSource={items}\n        renderItem={info => (\n          <Item\n            key={info.name}\n            info={info}\n            onArchive={() => {\n              archive(info.email);\n            }}\n          />\n        )}\n      />\n    </div>\n  );\n}\n\nexport default Index;\n")),(0,o.kt)("p",null,"Also in ",(0,o.kt)("inlineCode",{parentName:"p"},"archived/page.tsx"),", delete the original ",(0,o.kt)("inlineCode",{parentName:"p"},"mockData")," logic and use the ",(0,o.kt)("inlineCode",{parentName:"p"},"archived")," value computed in Model as the data source:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import { Helmet } from '@modern-js/runtime/head';\nimport { useModel } from '@modern-js/runtime/model';\nimport { List } from 'antd';\nimport Item from '../../components/Item';\nimport contacts from '../../models/contacts';\n\nfunction Index() {\n  const [{ archived }, { archive }] = useModel(contacts);\n\n  return (\n    <div className=\"container lg mx-auto\">\n      <Helmet>\n        <title>Archives</title>\n      </Helmet>\n      <List\n        dataSource={archived}\n        renderItem={info => (\n          <Item\n            key={info.name}\n            info={info}\n            onArchive={() => {\n              archive(info.email);\n            }}\n          />\n        )}\n      />\n    </div>\n  );\n}\n\nexport default Index;\n")),(0,o.kt)("p",null,"Execute ",(0,o.kt)("inlineCode",{parentName:"p"},"pnpm run dev"),", visit ",(0,o.kt)("inlineCode",{parentName:"p"},"http://localhost:8080/"),", click the Archive button, you can see the button grey out:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://lf3-static.bytednsdoc.com/obj/eden-cn/nuvjhpqnuvr/modern-website/tutorials/c07-contacts-all.png",alt:"display"})),(0,o.kt)("p",null,"Next, click the top navigation and switch to the Archives list. You can find that the point of contact of ",(0,o.kt)("strong",{parentName:"p"},"Archive")," just now has appeared in the list:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://lf3-static.bytednsdoc.com/obj/eden-cn/nuvjhpqnuvr/modern-website/tutorials/c07-contacts-archives.png",alt:"display"})),(0,o.kt)("h2",{id:"withdraw-container-components"},"Withdraw container components"),(0,o.kt)("p",null,"In the previous chapters, we split the business logic in the project into two layers, one is the ",(0,o.kt)("strong",{parentName:"p"},"view component"),", and the other is the ",(0,o.kt)("strong",{parentName:"p"},"module"),". The former is responsible for UI display, interaction, etc., and the latter is responsible for the implementation of UI-independent business logic, which specializes in managing state."),(0,o.kt)("p",null,"Like ",(0,o.kt)("inlineCode",{parentName:"p"},"src/routes/page.tsx")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"src/routes/archives/page.tsx")," use the component of the ",(0,o.kt)("inlineCode",{parentName:"p"},"useModel")," API, which is responsible for linking the two layers of View and Model, similar to the role of the Controller in the traditional MVC architecture. In the Modern.js, we follow the habit and call them ",(0,o.kt)("strong",{parentName:"p"},"Container"),"."),(0,o.kt)("p",null,"The container component is recommended to be placed in a special ",(0,o.kt)("inlineCode",{parentName:"p"},"containers/")," directory. We execute the following command to create a new file:"),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"macOS",label:"macOS",default:!0,mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir -p src/containers\ntouch src/containers/Contacts.tsx\n"))),(0,o.kt)(i.Z,{value:"Windows",label:"Windows",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-powershell"},"mkdir -p src/containers\nni src/containers/Contacts.tsx\n")))),(0,o.kt)("p",null,"We extracted the common part of the original two ",(0,o.kt)("inlineCode",{parentName:"p"},"page.tsx"),", and the code of ",(0,o.kt)("inlineCode",{parentName:"p"},"src/containers/Contacts.tsx")," is as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import { Helmet } from '@modern-js/runtime/head';\nimport { useModel } from '@modern-js/runtime/model';\nimport { List } from 'antd';\nimport Item from '../components/Item';\nimport { Helmet } from '@modern-js/runtime/head';\nimport { useModel } from '@modern-js/runtime/model';\nimport { List } from 'antd';\nimport Item from '../components/Item';\nimport contacts from '../models/contacts';\n\nfunction Contacts({\n  title,\n  source,\n}: {\n  title: string;\n  source: 'items' | 'archived';\n}) {\n  const [state, { archive }] = useModel(contacts);\n\n  return (\n    <div className=\"container lg mx-auto\">\n      <Helmet>\n        <title>{title}</title>\n      </Helmet>\n      <List\n        dataSource={state[source]}\n        renderItem={info => (\n          <Item\n            key={info.name}\n            info={info}\n            onArchive={() => {\n              archive(info.email);\n            }}\n          />\n        )}\n      />\n    </div>\n  );\n}\n\nexport default Contacts;\n")),(0,o.kt)("p",null,"Modify the code for ",(0,o.kt)("inlineCode",{parentName:"p"},"src/routes/page.tsx")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"src/routes/archives/page.tsx"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/routes/page.tsx"',title:'"src/routes/page.tsx"'},'import Contacts from \'../containers/Contacts\';\n\nfunction Index() {\n  return <Contacts title="All" source="items" />;\n}\n\nexport default Index;\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/routes/archives/page.tsx"',title:'"src/routes/archives/page.tsx"'},'import Contacts from \'../../containers/Contacts\';\n\nfunction Index() {\n  return <Contacts title="Archives" source="archived" />;\n}\n\nexport default Index;\n')),(0,o.kt)("p",null,"The refactoring is complete, and the current project structure is:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},".\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 dist\n\u251c\u2500\u2500 modern.config.ts\n\u251c\u2500\u2500 node_modules\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 pnpm-lock.yaml\n\u251c\u2500\u2500 src\n\u2502\xa0\xa0 \u251c\u2500\u2500 components\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 Avatar\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 index.tsx\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 Item\n\u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 index.tsx\n\u2502\xa0\xa0 \u251c\u2500\u2500 containers\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 Contacts.tsx\n\u2502\xa0\xa0 \u251c\u2500\u2500 models\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 contacts.ts\n\u2502\xa0\xa0 \u251c\u2500\u2500 modern-app-env.d.ts\n\u2502\xa0\xa0 \u251c\u2500\u2500 routes\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 archives\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 page.tsx\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 layout.tsx\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 page.tsx\n\u2502\xa0\xa0 \u2514\u2500\u2500 styles\n\u2502\xa0\xa0     \u2514\u2500\u2500 utils.css\n\u2514\u2500\u2500 tsconfig.json\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("strong",{parentName:"p"},"view components")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"components/")," dir are in the form of directories, such as ",(0,o.kt)("inlineCode",{parentName:"p"},"Avatar/index.tsx"),". And the ",(0,o.kt)("strong",{parentName:"p"},"container components")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"containers/")," dir are in the form of single files, such as ",(0,o.kt)("inlineCode",{parentName:"p"},"contacts.tsx"),". ",(0,o.kt)("strong",{parentName:"p"},"This is a best practice we recommend"),"."),(0,o.kt)("p",null,"As mentioned in the chapter ",(0,o.kt)("a",{parentName:"p",href:"/v2/en/docs/tutorials/first-app/c02-component"},"Add UI component"),", the view component is in the form of a directory, because the view component is responsible for the implementation of UI display and interaction details, and can evolve in complexity. In the form of a directory, it is convenient to add sub-files, including dedicated resources (pictures, etc.), dedicated sub-components, CSS files, etc. You can reconstruct at will within this directory, considering only the smallest parts."),(0,o.kt)("p",null,"The container component is only responsible for linkage and is a glue layer. The sophisticated business logic and implementation details are handed over to the View layer and the Model layer for implementation. The container component itself should be kept simple and clear, and should not contain complex implementation details, so there should be no internal structure. The single-file form is not only more concise, but also acts as a constraint, reminding developers not to write complicated container components."))}u.isMDXComponent=!0}}]);