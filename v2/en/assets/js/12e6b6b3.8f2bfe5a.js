"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1377],{44993:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>c});var i=n(52983);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},l=Object.keys(e);for(i=0;i<l.length;i++)n=l[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(i=0;i<l.length;i++)n=l[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=i.createContext({}),s=function(e){var t=i.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=s(e.components);return i.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,p=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),m=s(n),c=a,f=m["".concat(p,".").concat(c)]||m[c]||d[c]||l;return n?i.createElement(f,o(o({ref:t},u),{},{components:n})):i.createElement(f,o({ref:t},u))}));function c(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,o=new Array(l);o[0]=m;var r={};for(var p in t)hasOwnProperty.call(t,p)&&(r[p]=t[p]);r.originalType=e,r.mdxType="string"==typeof e?e:a,o[1]=r;for(var s=2;s<l;s++)o[s]=n[s];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},78954:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>d,frontMatter:()=>l,metadata:()=>r,toc:()=>s});var i=n(18249),a=(n(52983),n(44993));const l={title:"**/*.[tj]s",sidebar_position:1},o=void 0,r={unversionedId:"apis/app/hooks/api/functions/api",id:"apis/app/hooks/api/functions/api",title:"**/*.[tj]s",description:"Declaring API routing in BFF function mode. Except some files\uff0cfiles in api/ are registered as routes.",source:"@site/../../packages/toolkit/main-doc/en/docusaurus-plugin-content-docs/current/apis/app/hooks/api/functions/api.md",sourceDirName:"apis/app/hooks/api/functions",slug:"/apis/app/hooks/api/functions/api",permalink:"/v2/en/docs/apis/app/hooks/api/functions/api",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"**/*.[tj]s",sidebar_position:1},sidebar:"apisAppSidebar",previous:{title:"*.[server|node].[tj]sx",permalink:"/v2/en/docs/apis/app/hooks/src/server"},next:{title:"**/_*.[tj]s, _*/**",permalink:"/v2/en/docs/apis/app/hooks/api/functions/common"}},p={},s=[{value:"Routing Rule",id:"routing-rule",level:2},{value:"Default Route",id:"default-route",level:3},{value:"Multi Level Route",id:"multi-level-route",level:3},{value:"Dynamic Route",id:"dynamic-route",level:3},{value:"Allow List",id:"allow-list",level:3},{value:"Define Function",id:"define-function",level:2}],u={toc:s};function d(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,i.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Declaring API routing in BFF function mode. Except ",(0,a.kt)("a",{parentName:"p",href:"/docs/apis/app/hooks/api/functions/api#allow-list"},"some files"),"\uff0cfiles in ",(0,a.kt)("inlineCode",{parentName:"p"},"api/")," are registered as routes."),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"use ",(0,a.kt)("inlineCode",{parentName:"p"},"api/")," need execute new command to enable the \u300cBFF\u300d feature.")),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"this file supports the use ",(0,a.kt)("inlineCode",{parentName:"p"},"js")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"ts"),", but the functions must be exported using the ESM syntax.")),(0,a.kt)("h2",{id:"routing-rule"},"Routing Rule"),(0,a.kt)("h3",{id:"default-route"},"Default Route"),(0,a.kt)("p",null,"The files named ",(0,a.kt)("inlineCode",{parentName:"p"},"index")," will be upper level routing:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"api/index.ts")," -> ",(0,a.kt)("inlineCode",{parentName:"li"},"$BASENAME/")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"api/user/index.ts")," -> ",(0,a.kt)("inlineCode",{parentName:"li"},"$BASENAME/user"))),(0,a.kt)("h3",{id:"multi-level-route"},"Multi Level Route"),(0,a.kt)("p",null,"The routing system also supports parsing multiple levels of files. and if you create a folder, the files will still be automatically parsed in the same way."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"api/hello.ts")," -> ",(0,a.kt)("inlineCode",{parentName:"li"},"$BASENAME/hello")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"api/user/list.ts")," -> ",(0,a.kt)("inlineCode",{parentName:"li"},"$BASENAME/user/list"))),(0,a.kt)("h3",{id:"dynamic-route"},"Dynamic Route"),(0,a.kt)("p",null,"Dynamic named routing parameters can be supported by creating folders or files with ",(0,a.kt)("inlineCode",{parentName:"p"},"[xxx]"),"."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"api/user/[username]/info.ts")," -> ",(0,a.kt)("inlineCode",{parentName:"li"},"$BASENAME/user/:username/info")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"api/user/[username]/delete.ts")," -> ",(0,a.kt)("inlineCode",{parentName:"li"},"$BASENAME/user/:username/delete")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"api/article/[id]/info.ts")," -> ",(0,a.kt)("inlineCode",{parentName:"li"},"$BASENAME/article/:id/info"))),(0,a.kt)("p",null,"the ",(0,a.kt)("inlineCode",{parentName:"p"},"$BASENAME")," can be configured in ",(0,a.kt)("inlineCode",{parentName:"p"},"modern.config.js"),"\uff0cthe default value is ",(0,a.kt)("inlineCode",{parentName:"p"},"/api"),"\u3002"),(0,a.kt)("h3",{id:"allow-list"},"Allow List"),(0,a.kt)("p",null,"By default, all files in the ",(0,a.kt)("inlineCode",{parentName:"p"},"api/")," will be parsed as BFF function. but we also set a allow list, and these files will not be parsed:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"file name start with ",(0,a.kt)("inlineCode",{parentName:"li"},"_"),", for example: ",(0,a.kt)("inlineCode",{parentName:"li"},"_utils.ts"),"."),(0,a.kt)("li",{parentName:"ul"},"files in directory that name start with ",(0,a.kt)("inlineCode",{parentName:"li"},"_"),", for example\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"_utils/index.ts"),"\u3001",(0,a.kt)("inlineCode",{parentName:"li"},"_utils/cp.ts"),"."),(0,a.kt)("li",{parentName:"ul"},"test files, for example\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"foo.test.ts"),"."),(0,a.kt)("li",{parentName:"ul"},"TypeScript define files, for example\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"hello.d.ts"),"."),(0,a.kt)("li",{parentName:"ul"},"files in ",(0,a.kt)("inlineCode",{parentName:"li"},"node_module"),".")),(0,a.kt)("h2",{id:"define-function"},"Define Function"),(0,a.kt)("p",null,"In addition to the above routing rules, the function definition and export in the code also have conventions."),(0,a.kt)("p",null,"function need named exports\uff0cand the name of the exported function is the HTTP Method:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"export const get = async () => {\n  return {\n    name: 'Modern.js',\n    desc: 'Modern web Solutions',\n  };\n};\n")),(0,a.kt)("p",null,"Export the function like above will generate a ",(0,a.kt)("inlineCode",{parentName:"p"},"POST")," interface."),(0,a.kt)("p",null,"App support 9 Method definitions: ",(0,a.kt)("inlineCode",{parentName:"p"},"GET"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"POST"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"PUT"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"DELETE"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"CONNECT"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"TRACE"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"PATCH"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"OPTION"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"HEAD"),". so App can use these name as function export nane."),(0,a.kt)("p",null,"The name is insensitive, whaterver ",(0,a.kt)("inlineCode",{parentName:"p"},"get"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"Get"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"GEt"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"GET"),", can be accurately identified. And default export, ",(0,a.kt)("inlineCode",{parentName:"p"},"export default xxx")," will be ",(0,a.kt)("inlineCode",{parentName:"p"},"Get")," method."),(0,a.kt)("p",null,"because ",(0,a.kt)("inlineCode",{parentName:"p"},"delete")," is a keyword in JavaScript, use ",(0,a.kt)("inlineCode",{parentName:"p"},"del")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"DELETE")," instead."),(0,a.kt)("p",null,"Multiple functions of different Methods can be defined in one file, but if multiple functions of the same Method are defined, only the first can work."),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"It should be noted that the defined functions should be asynchronous, which is related to the type when the function is called.")))}d.isMDXComponent=!0}}]);